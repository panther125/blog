---
title: 数据链路层详解
data: 2021-05-29
categories:
- 计算机网络
tags:
- 计算机网络
---
# 数据链路层概述
1. 数据传输路线图
![](https://pic.imgdb.cn/item/626e5e09239250f7c5800045.png)
2. 数据链路层基本概念
[结点]{.red} ：主机、路由器
[链路]{.red} ：网络中两个结点之间的物理通道，链路的传输介质主要有双绞线、光纤和微波。分为有线链路、无线链路。
[数据链路]{.red} ：网络中两个结点之间的逻辑通道，把实现控制数据传输协议的硬件和软件加到链路上就构成数据链路。
[帧]{.red} ：链路层的协议数据单元，封装网络层数据报。
3. 主要功能
[数据链路层在物理层提供服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据可靠地传输到相邻节点的目标机网络层。其主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路。]{.lable}
# 数据链路层功能概述
==功能一==：为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务。
==功能二==：链路管理，即连接的建立、维持、释放（用于面向连接的服务）
==功能三==：组帧。
==功能四==：流量控制。
==功能五==：差错控制（帧错/位错）
# 解决传输错误的方法
## 封装成帧(Frame)
[封装成帧]{.red}就是在一段数据的前后部分添加首部和尾部，这样就构成了一个帧。接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束。
首部和尾部包含许多的控制信息，他们的一个重要作用：帧定界（确定帧的界限）。
帧同步：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止。
![](https://pic.imgdb.cn/item/626e5eb8239250f7c581c359.png)
[组帧的四种方法]{.blue}
1.字符计数法，2.字符（节）填充法，3.零比特填充法，4.违规编码法。
# 差错控制
## 差错从何而来？
概括来说，传输中的差错都是由于噪声引起的。
[全局性]{.red} 1.由于线路本身电气特性所产生的随机噪声(热噪声)，是信道固有的，随机存在的。
解决办法：提高信噪比来减少或避免干扰。（对传感器下手）
[局部性]{.blue} 2.外界特定的短暂原因所造成的冲击噪声，是产生差错的主要原因。
解决办法：通常利用编码技术来解决。
常见差错

    1. 位错：比特位出错，1变成0，0变成1.
    2. 帧错：
            1. 丢失：传入123收到12.
            2. 序错：传入123收到132.
            3. 重复：传入123收到1223.
:::info
差错纠正
:::
一般是采用**反馈检测**的方法来进行纠错，在接受端接受到一帧的数据，向发送端反馈接收到的数据，如果数据与发送端的数据不相同就从新发送数据帧
# 流量控制与可靠传输机制
![](https://pic.imgdb.cn/item/626e60ca239250f7c586ebd6.png)
较高的发送速度和较低的接收的不匹配，会造成传输错误因此流量控制也是数据链路层的一项重要工作。
[数据链路层]{.blue}流量控制手段：接收方收不下就不回复确认。
[传输层]{.green}流量控制手段：接收端给发送端一个窗口公告。
## 流量控制的方法
1. 停止-等待协议：每发送完一个帧就停止发送等待对方的确认，在收到确认后再发送下一个帧。
2. 滑动窗口协议：
                1. 后退N帧协议（GBN） 发送方需要缓存多个分组，可以发送多个分组。
                2. 选择重传协议（SR）发送进程根据一个指定大小的 窗口持续发送若干帧 ，即使发送过程中丢失帧，也会继续发送。
# 三种协议详解
## 停止-等待协议
1. 为什么要有停止-等待协议？
除了比特出差错，底层信道还会出现丢包问题。为了实现流量控制。
丢包：物理线路故障、设备故障、病毒攻击、路由信息错误等原因，会导致数据包的丢失。
2. 研究停等协议的前提？
虽然现在常用全双工通信方式，但为了讨论问题方便，仅考虑一方发送数据（发送方），一方接收数据（接收方）。
因为是在讨论可靠传输的原理，所以并不考虑数据是在哪一个层次上传送的。
“停止-等待”就是每发送完一个分组就停止发送，等待对方确认，在收到确认后再发送下一个分组。
3. 停等协议有几种应用情况？
无差错情况&有差错情况
## 选择重传协议（SR）
1. 后退N帧协议（GBN）协议的弊端
累计确认批量重传，资源浪费。
[解决办法]{.red}：
    设置单个确认，同时加大接收窗口，设置接收缓存，缓存乱序到达的帧。
只重传错误的帧。
2. SR发送方必须响应的三件事
[1.上层的调用]{.blue}
从上层收到数据后，SR发送方检查下一个可用于该帧的序号，如果序号位于发送窗口内，则发送数据帧；否则就像GBN一样，要么将数据缓存，要么返回给上层之后再传输。
[2.收到了一个ACK]{.blue}
如果收到ACK，加入该帧序号在窗口内，则SR发送方将那个被确认的帧标记为已接收。如果该帧序号是窗口的下界（最左边第一个窗口对应的序号），则窗口向前移动到具有最小序号的未确认帧处。如果窗口移动了并且有序号在窗口内的未发送帧，则发送这些帧。
[3.超时事件]{.blue}
每个帧都有自己的定时器，一个超时事件发生后只重传一个帧。
3. 接收方的工作
SR接收方将确认一个正确接收的帧而不管其是否按序。失序的帧将被缓存，并返回给发送方一个该帧的确认帧【收谁确认谁】，直到所有帧（即序号更小的帧）皆被收到为止，这时才可以将一批帧按序交付给上层，然后向前移动滑动窗口。
[总结为：来者不拒]{.red}
### 滑动窗口的长度
滑动窗口的长度能无限长吗？
发送窗口最好等于接受窗口（大了会溢出小了会无意义）
W~TMAX~=W~RMAX~=2^(n-1)^
### 重点总结
1. 对数据帧逐一确认，接受一个确认一个。
2. 只重传错帧。
3. 接收方有缓存。
4. W~TMAX~=W~RMAX~=2^(n-1)^
# 后退N帧协议（GBN）
1. 窗口
接收窗口 ：接收方维持一组连续的允许接收帧的序号。
发送窗口 ：发送方维持一组连续的允许发送帧的序号。
2. GBN发送方必须响应的三件事
[1.上层的调用]{.blue}
上层要发送数据时，发送方先检查发送窗口是否已满，如果未满，则产生一个帧并将其发送；如果窗口已满，发送方只需将数据返回给上层，暗示上层窗口已满。上层等一会再发送。
（实际实现中，发送方可以缓存这些数据，窗口不满时再发送帧）
[2.收到了一个ACK]{.blue}
GBN协议中，对n号帧的确认采用累积确认的方式，标明接收方已经收到n号帧和它之前的全部帧。
[3.超时事件]{.blue}
协议的名字为后退N帧/回退N帧，来源于出现丢失和时延过长帧时发送方的行为。
就像在停等协议中一样，定时器将再次用于恢复数据帧或确认帧的丢失。如果出现超时，发送方重传所有已发送但未被确认的帧。
3. 接收方的工作
如果正确收到n号帧，并且按序，那么接收方为n帧发送一个ACK,并将该帧中的数据部分交付给上层。其余情况都丢弃帧，并为最近按序接收的帧重新发送ACK。接收方无需缓存任何失序帧，只需要维护一个信息：expectedseqnum（下一个按序接收的帧序号）.
### 滑动窗口的长度
滑动窗口的长度能无限长吗？
若采用n个比特对帧编号，那么发送窗口的尺寸WT应满足：
1≤W~T~≤2n-1。因为发送窗口尺寸过大，就会使得接收方无法区别新帧和旧帧。
### 重点总结
1. 累计确认
2. 接收方只按顺序接受帧，不按序无情丢弃。
3. 确认序列号最大的，按序到达的帧。
4. 1≤W~T~≤2n-1
# 十种通信控制字符
* ACK（Acknowledge）：[确认标志]{.red}，由接收端发出的，作为对正确接收到报文的响应。
* DLE（Data Link Escape）：[转义标志]{.red}，用于指示后面的字符是数据字符，而不是特殊控制字符。
* ENQ（Enquire）：[询问标志]{.red}，用于请求远程站点给出响应。响应可能包括远程站点的身份或状态
* EOT（End of Transmission）：[发送完毕标志]{.red}，用于表示一个或多个文本的发送结束，并拆除链路。
* ETB（End of transmission Block）：[块终止或组终止标志]{.red}，用于标志每个数据块的结束位置
* ETX（End of Text）：[文本终止标志]{.red}，标志报文文本的结束
* NAK（Negative Acknowledge）：[否认标志]{.red}，由接收端发出的，作为对未正确接收的报文响应
* SOH（Start of Head）：[报头开始标志]{.red}，用于表示报文的标题信息或报头的开始
* STX（Start of Test）：[文本开始标志]{.red}，标志标题信息的结束和报文文本的开始
* SYN（Synchronous）：[字符同步标志]{.red}，用以实现通信双方的字符同步，或用于在无数据传输时保持同步
# 信道划分
## 传输数据使用的两种线路
[点对点链路]{.blue}
两个相邻节点通过一个链路相连，没有第三者。
应用：PPP协议，常用于广域网。
[广播式链路]{.blue}
所有主机共享通信介质。
应用：早期的总线以太网、无线局域网，常用于局域网。
## 介质访问控制
介质访问控制的内容就是，采取一定的措施，使得两对节点之间的通信不会发生互相干扰的情况。
![](https://pic.imgdb.cn/item/626e5ee2239250f7c5823593.png)
信道划分介质访问控制：将使用介质的每个设备与来自同一信道上的其他设备的通信隔离开，把
[时域]{.red}和[频域]{.red}资源合理地分配给网络上的设备。
多路复用技术把多个信号组合在一条物理信道上进行传输，使得多个计算机或终端设备共享信道资源，接受时使用分路把一条广播信道，逻辑上分成几条用于两个节点之间通信的互不干扰的子信道，实际就是广播信道转变为点对点信道，提高信道利用率。
* FDM:用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。频分复用的所有用户
在同样的时间占用不同的带宽（频率带宽）资源。充分利用传输介质带宽，系统效率较高；由于技术比较成熟，实现也比较容易。类似于[并行]{.red}。
* TDM:将时间划分为一段段等长的时分复用帧（TDM帧）。每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙，所有用户轮流占用信道。类似于[并发]{.red}。
* STDM:每一个STDM帧中的时隙数小于连接在集中器上的用户数。各用户有了数据就随时发往集中器的输入缓存，然后集中器按顺序依次扫描输入缓存，把缓存中的输入数据放入STDM帧中，一个STDM帧满了就发出。STDM帧不是固定分配时隙，而是按需动态分配时隙。
* WDM:波分多路复用就是光的频分多路复用，在一根光纤中传输多种不同波长（频率）的光信号，由于波长（频率）不同，所以各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来。
* CDM:码分多址（CDMA）是码分复用的一种方式。
1个比特分为多个码片/芯片（chip），每一个站点被指定一个唯一的m位的芯片序列。
发送1时站点发送芯片序列，发送0时发送芯片序列反码（通常把0写成-1）
如何不打架：多个站点同时发送数据的时候，要求各个站点芯片序列相互正交.
如何合并：各路数据在信道中被线性相加。
如何分离：合并的数据和源站规格化内积。
## ALOHA协议
* 纯ALOHA协议思想：不监听信道，不按时间槽发送，随机重发。
冲突如何检测？
+++info 答案
如果发生冲突，接收方在就会检测出差错，然后不予确认，发送方在一定时间内收不到就会判断发生冲突。
+++
冲突如何解决
+++info 答案
超时后等一随机时间在重传。
+++
* 时隙ALOHA协议：把时间分成若干个时间片，所有用户在时间片开始时刻同步接入网络信道若发生冲突，则必须等到下一个时间片开始在发送。
## 两类协议比较
1. 纯ALOHA协议比时隙ALOHA协议吞吐量低，效率低。
2. 纯ALOHA协议想发就发，时隙ALOHA协议只有在时间片开始时刻发送。
## CSMA协议
CS:载波侦听/监听，每一个站在发送[数据之前]{.red}要检测一下总线上是否有其他计算机在
发送数据。
如何检测？
+++info 答案
当几个站在总线上同时发送数据时，总线上的信号电压摆动值将会增大（相互叠加）。当一个站检测到的信号电压摆动值超过一定门限时，就认为总线上至少有两个站同时发送数据，表明产生了碰撞，发生了冲突。
+++
MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。
协议思想:在发送帧之前监听信道。
* 1-坚持CSMA思想：在信道忙时，会一直监听信道直到空闲发送，在信道空闲时会直接传输。
优点：只要媒体空闲站点就马上发送，避免了媒体利用率的损失。
缺点：如果有两个或更多站点要发送数据，这冲突就不可避免。
* 非坚持CSMA思想：在信道忙时，会等到一个随机时间监听信道直到空闲发送，在信道空闲时会直接传输。
优点：采用随机的重发延迟时间可以冲突发生的可能性，
缺点：可能存在大家都在延迟等待的过程中使得媒体任然处于空闲状态，媒体使用率降低。
* p-坚持CSMA协议思想：空闲则以p概率传输，概率1-p等到下一个时间槽在传输，信道忙则等到一个随机空闲时间在传输。
优点：既能象非坚持一样减少冲突，又能想1-坚持算法那样减少媒体空闲时间的方案。
缺点：发生冲突后还是坚持把数据发送完，造成浪费。
有没有方法可以减少浪费？一冲突就能发现？
## 三种CSMA协议对比
![](https://pic.imgdb.cn/item/626e5f00239250f7c5828a2c.png)
## CSMA-CD协议
CSMA/CD：载波监听多点接入/碰撞检测
CS:载波侦听/监听，每一个站在[发送数据之前]{.red}以及[发送数据时]{.red}
都要检测一下总线上是否有其他计算机在发送数据。
MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。
CD：碰撞检测（冲突检测），[边发送边监听]{.red}，设配器边发送数据边检测信道上信号电压的变化情况以便判断自己在发送数据时其他站点也在发送数据。
## CSMA-CA协议
CSMA/CA：CSMA/CD：载波监听多点接入/碰撞避免
CSMA-CA协议工作原理：
1. 发送数据前，先检测信道是否空闲。
2. 空闲则发出RTS（request to send），RTS包括发送端的地址，接受端的地址，下一份数据将持续发送的时间的信息，信道忙则需等待。
3. 接受端收到一个RTS后，将响应CTS（clean to send）。
4. 发送端收到CTS后，开始发送数据帧（同时预约信道：发送方告知其他站点自己传多久数据）
5. 接受端收到数据帧后将用CRC来检验数据是否正确，正确则响应ACK帧。
6. 发送方收到ACK帧就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止
（采用[二进制指数退避算法]{.yellow}来确认随机的推迟时间）.
## CSMA-CD与CSMA-CA两种协议的比较
[相同点]{.blue}：
* CSMA/CA与CSMA/CD协议机制都从属于CSMA思想，其核心为[先听再说]{.red}，
换言之两个在接入信道之前必须要监听，当发现信道空闲时，才能接入
[不同点]{.red}
* 传输介质不同：CSMA/CD用于总线式以太网【有线】，CSMA/CA用于无线式局域网【无线】
* 载波检测方式不同：因传输介质不同，CSMA/CD与CSMA/CA的检测方式也不同。CSMA/CD
通过电缆中电压的变化来检测，当数据发生碰撞时，电缆中的电压就会随机发生变化；而CSMA/CA
采用能能检测【ED】和载波检测【CS】和能量载波混合检测三种检测信道空闲的方式。
* CSMA/CD检测冲突CSMA/CD避免冲突，二者发生冲突都会进行有限的重传。
# 总结导图
![](https://pic.imgdb.cn/item/626e5f27239250f7c582f57c.png)